---
id: proxy-use
title: Proxy的妙用
author: dell_di
author_title: Do review after learning
author_url: https://github.com/Dell_Di
author_image_url: https://avatars1.githubusercontent.com/u/17883920?s=460&v=4
tags: [Proxy, Reflect]
---

<!--truncate-->

## Proxy代理

### Proxx.set(target,key,value,receiver)拦截
1. `target`源对象
2. `key`源对象的key
3. `value`源对象的value
4. `receiver`一般是代理实例本身

```js
// 验证规则
const validators = {
    name: {
        validate(value) {
            return value.length > 6;
        },
        message: '用户名长度不能小于六'
    },
    phone: {
        validate(value) {
            return /^1(3|5|7|8|9)[0-9]{9}$/.test(value);
        },
        message: '手机号格式错误'
    }
}
```

> 利用Proxy的`set`进行代理拦截,配合反射Reflect进行正常的set计算

```js
    function validator(obj, validators) {
        return new Proxy(obj, {
            set(target,key,value,receiver) {
                const validator = validators[key]
                if (!validator) {
                    Reflect.set(target, key, value)
                } else if (validator(value)) {
                    Reflect.set(target, key, value)
                } else {
                    alert('xxx err message')
                }
            }
        })
    }
    let form = {
        name: 'xxxxxxx',
        phone: '123333333'
    }
    validator(form,validators);
    // alert('xxx err message');
```
==ps==: 如若该属性被`Object.defineProperty(form, 'name', { writable: false })`,Proxy的set拦截方法依然生效，但是赋值不生效

### Proxy.get 定义私有属性和初始化
`get` 方法用来拦截对目标对象属性的读取，它接收三个参数，分别是目标对象、属性名和 Proxy 实例本身。一般定义属性我们以_ 开头表明是私有属性.阻止访问
```js
// 私有属性
    const person = {
        name: 'tom',
        age: 20,
        _sex: 'male'
    }
    const proxy = new Proxy(person, {
        get(target, prop, reciver) {
            if (prop[0] === '_') {
                throw new Error(`当前属性不可访问`)
            }
            return target[prop]
        }
    })
    
    person.name // 'tom'
    person._sex // error 当前属性不可访问
// 未定义属性 初始化值
    const person1 = {
        name: 'tom',
        age: 20
    }
    const proxyInital = (target, initial) =>{
        return new Proxy(target, {
            get(target, prop, reciver) {
                if (prop in target) {
                    return target[prop]
                }
                return initial
            }
        })
    }
    
    proxyInital(person1, 'girl')
    person1.sex // 'girl'
    
```